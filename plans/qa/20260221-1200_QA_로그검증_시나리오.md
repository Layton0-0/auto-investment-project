# QA 로그 검증 시나리오

**작성일:** 2026-02-21  
**목적:** REST Client(`plans/qa/api-qa.http`)로 API 호출 시, 로컬 백엔드 로그에서 확인할 항목 정리.

---

## 사용 방법

1. 백엔드(또는 Docker) 로그를 **실시간으로 보이는 터미널**에서 실행.
2. REST Client로 `api-qa.http` 요청을 **순서대로** 실행.
3. 각 요청 직후 아래 표의 **로그 확인 키워드**로 로그에서 해당 줄이 나오는지 확인.
4. **4xx/5xx** 응답이면 응답 body의 **traceId**를 복사해 로그에서 검색하면 스택 트레이스·원인 파악 가능.

---

## 요청별 로그 검증 표

| ID | API | 예상 HTTP | 로그 확인 키워드 | 비고 |
|----|-----|-----------|------------------|------|
| 1 | POST /api/v1/auth/login | 200 | `로그인 성공`, `userId=`, `username=` | 실패 시 `DomainException`, `INVALID_PASSWORD` 또는 계정 잠금 메시지 |
| 2 | GET /api/v1/auth/mypage | 200 | `마이페이지 조회`, `userId=` | 500 시 스택 트레이스·`traceId` 검색. 암복호화/DB 예외 가능 |
| 3 | GET /api/v1/market-data/current-price/005930 | 200 | (시장데이터 조회 로그 있으면 확인) | 인증 필요 시 401 |
| 4 | GET /api/v1/market-data/daily-chart | 404 | (엔드포인트 없음 → 404 응답, 로그에 404 또는 NoResourceFoundException 가능) | 백엔드 미구현 |
| 5 | GET /api/v1/settings/accounts | 200 | (설정 계좌 조회 관련 로그) | - |
| 6 | GET /api/v1/settings/{accountNo} | 200 또는 400 | 200: 정상. 400: `DomainException`, `SETTING_NOT_FOUND`, `거래 설정을 찾을 수 없습니다` | 계좌별 설정 없으면 400 |
| 7 | PUT /api/v1/settings/{accountNo} | 200 | `거래 설정 저장`, `accountNo=`, `maxAmount=`, `minAmount=` | - |
| 8 | POST /api/v1/auth/logout | 200 | (로그아웃 처리 로그 있으면 확인) | - |

---

## 오류 시 로그에서 할 일

- **500 Internal Server Error**  
  - 응답 body에 `traceId`가 있으면 로그에서 해당 `traceId` 검색.  
  - 같은 시각대의 `Exception`, `Caused by`, 스택 트레이스를 확인.

- **400 Bad Request**  
  - `DomainException`, `SETTING_NOT_FOUND`, `USER_NOT_FOUND`, `API_KEY_NOT_FOUND` 등 `ErrorCode`와 메시지 확인.  
  - 필요 시 `traceId`로 전후 로그 확인.

- **401 Unauthorized**  
  - 토큰 없음/만료/잘못된 토큰. 로그인(1번) 재실행 후 `token` 갱신.

---

## 참고

- 로그 레벨이 `DEBUG`이면 `userId(actual)`, `username(actual)` 등 마스킹 해제 로그도 나올 수 있음.
- `api-qa.http`와 동일한 요청 순서로 번호를 맞춰 두었으므로, 위 표 ID와 .http 블록 순서를 대응해 사용하면 됨.
