# 메뉴별 API 및 유효데이터 검증 체크리스트

**작성일**: 2026-02-21  
**목적**: 전체 메뉴·버튼 클릭 시 호출되는 API와 serverType(모의=1, 실=0)별 유효데이터 조건. 한국투자증권(KIS) 기준.

---

## 1. 사용자 메뉴

| 메뉴 | 경로 | 주요 API (accountNo·serverType 연동) | 유효데이터 조건 | 모의(1) | 실(0) |
|------|------|--------------------------------------|-----------------|---------|-------|
| 대시보드 | /dashboard | GET /api/v1/user/accounts/main?serverType=0\|1, GET /api/v1/accounts/{accountNo}/assets, /positions, GET /api/v1/orders?accountNo=, GET /api/v1/pipeline/summary?accountNo=, GET /api/v1/settings/{accountNo}, GET /api/v1/dashboard/performance-summary | 200 + 계좌·자산·포지션·주문·파이프라인 요약 또는 계좌 없음 시 "설정에서 계좌 연결" 안내 | □ | □ |
| 자동투자 현황 | /auto-invest | getMainAccount(serverType), getPipelineSummary(accountNo) | 200 + 파이프라인 요약 또는 빈 상태 메시지 | □ | □ |
| 국내 전략 | /strategies/kr | GET /api/v1/strategies/{accountNo}?market=KR | 200 + 전략 목록 또는 빈 배열 | □ | □ |
| 미국 전략 | /strategies/us | GET /api/v1/strategies/{accountNo}?market=US | 200 + 전략 목록 또는 빈 배열 | □ | □ |
| 뉴스·이벤트 | /news | GET /api/v1/news (page, size, market 등), POST /api/v1/news/collect (버튼) | 200 + 뉴스 목록(빈 배열 가능). 수집 버튼 200/502 등 처리 | □ | □ |
| 포트폴리오 | /portfolio | getMainAccount, getPositions, getOrders, 시세/차트 API | 200 + 보유 종목·주문·일봉 차트 또는 빈 상태 | □ | □ |
| 주문·체결 | /orders | GET /api/v1/orders?accountNo= | 200 + 주문 목록 또는 빈 배열 | □ | □ |
| 백테스트 | /backtest | GET /api/v1/trading-portfolios/latest, rebalance-suggestions, today, GET /api/v1/backtest/robo/last-pre-execution?accountNo=, POST 실행 등 | 200/204/400(포트폴리오 없음) 등. accountNo 필수 시 400 가능 | □ | □ |
| 설정 | /settings | GET /api/v1/settings/accounts, GET /api/v1/settings/{accountNo}, PUT/POST 설정 저장, getMainAccount(0\|1) | 200 + 설정·계좌 목록. 저장 200 | □ | □ |
| 연말 세금·리포트 | /report/tax | GET /api/v1/report/tax/summary?year= | 200 + 요약 DTO(스텁 시 null 필드 가능) | □ | □ |

---

## 2. Ops 메뉴 (Admin 전용)

| 메뉴 | 경로 | 주요 API | 유효데이터 조건 | 모의(1) | 실(0) |
|------|------|----------|-----------------|---------|-------|
| 데이터 파이프라인 | /ops/data | GET /api/v1/ops/data-pipeline/status, **GET /batch/api/jobs** (배치 목록) | 200 + 원천별 상태·배치 Job 목록. **nginx가 /batch → backend 프록시 필요** | □ | □ |
| 알림센터 | /ops/alerts | GET /api/v1/ops/alerts (page, size, level) | 200 + 알림 목록(페이징) | □ | □ |
| 리스크 리포트 | /risk | GET /api/v1/risk/* (portfolio-metrics 등) | 200 또는 404(계좌 데이터 없음 정상) | □ | □ |
| 모델/예측 상태 | /ops/model | GET /api/v1/ops/model/status | 200 + modelReady, serviceUrl 등 | □ | □ |
| 감사 로그 | /ops/audit | GET /api/v1/ops/audit (page, size, eventType, from, to) | 200 + 감사 로그 목록 | □ | □ |
| 시스템 헬스 | /ops/health | GET /api/v1/ops/health | 200 + db, redis, predictionService 상태 | □ | □ |
| 전략 거버넌스 | /ops/governance | GET /api/v1/ops/governance/results, GET /api/v1/ops/governance/halts, PUT .../clear | 200 + 검사 결과·halt 목록 | □ | □ |

---

## 3. 공통·기타 API

| API | 용도 | 유효데이터 조건 |
|-----|------|-----------------|
| POST /api/v1/auth/login | 로그인 | 200 + token |
| GET /api/v1/user/accounts/main?serverType= | 메인 계좌 (KIS 연동) | 200 + accountNo 또는 204/404(계좌 없음) |
| GET /api/v1/accounts/{accountNo}/assets | 잔고 (KIS) | 200 + 자산 DTO 또는 404/400 → null 처리 |
| GET /api/v1/accounts/{accountNo}/positions | 보유 종목 (KIS) | 200 + 배열 또는 404 → [] |
| GET /api/v1/market-data/current-price, current-prices, daily-chart | 시세·차트 | 200 + 데이터 또는 빈 배열 |
| POST /api/v1/trigger/{path} | 배치 수동 실행 (Ops) | 200 + 결과 |
| GET /batch/api/jobs | 배치 Job 목록 | 200 + 배열. **현재 nginx /api 만 프록시 → /batch 별도 프록시 필요** |

---

## 4. KIS(한국투자증권) 설정

- **Backend** `.env`: SUPER_ADMIN용 모의 `SUPER_ADMIN_VIRTUAL_*`, 실전 `SUPER_ADMIN_REAL_*` (APP_KEY, APP_SECRET, ACCOUNT_NO).  
- **모의(1)** / **실(0)** 전환 시 `serverType` 쿼리로 메인 계좌·잔고·주문 등 API 호출. 미연동 시 "계좌 없음" 또는 204/404 정상.

---

## 5. 검증 절차

1. **풀스택 기동**: [20260221-1900_로컬_풀스택_기동_가이드.md](20260221-1900_로컬_풀스택_기동_가이드.md) 참고.
2. **로그인** 후 상단에서 **모의계좌** 탭 선택 → 각 메뉴 진입·버튼 클릭 → 위 표 기준으로 200 및 유효 데이터(또는 명시적 빈/안내) 확인.
3. **실계좌** 탭 선택 → 동일 검증 (KIS 실계좌 연동 시).
4. **Admin** 계정으로 Ops 메뉴 동일 검증.
5. 미통과 항목: Backend/Frontend 수정 후 재검증. 수정 이력은 [최종_QA_체크리스트.md](최종_QA_체크리스트.md) §2에 반영.

---

## 6. Known 이슈 (사전 반영)

- **GET /batch/api/jobs**: 프론트가 `/batch/api/jobs` 호출. nginx가 `/api` 만 backend로 보내므로 `/batch` 는 frontend로 가서 502. → **nginx에 `location /batch { proxy_pass http://backend:8080; }` 추가 필요.**
- GET /api/v1/strategies (accountNo 없이): 500. 반드시 GET /api/v1/strategies/**{accountNo}** 호출.
- GET /api/v1/risk/portfolio-metrics: 해당 계좌 데이터 없으면 404 (정상).
- GET /api/v1/trading-portfolios/today: 오늘 포트폴리오 없으면 400 (비즈니스 정상).
