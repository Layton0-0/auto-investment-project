---
description: Test code must be written and executed after plan-based development
alwaysApply: true
---

# Test Code After Plan-Based Development

When development is completed using a plan (via `mcp_create_plan` tool), the agent **MUST**:

1. **Write test code** for all new or modified functionality
   - Unit tests for service methods
   - Integration tests for API endpoints
   - Slice tests for controllers (using `@WebMvcTest`, `@DataJpaTest`, etc.)
   - Test coverage should align with project standards (line ≥80%, branch ≥70%)

2. **Execute tests directly** using the appropriate test command
   - Run tests: `.\scripts\run-tests.ps1` or `gradlew test`
   - Run tests with coverage: `.\scripts\run-tests-with-coverage.ps1` or `gradlew test jacocoTestReport`
   - **Frontend/screen changes**: Prefer browser verification (cursor-ide-browser MCP) or run Playwright E2E: `cd investment-frontend && npm run e2e`
   - Verify all tests pass before considering the work complete

3. **Iterate until all tests pass**
   - If tests fail, fix the code and/or test code
   - Re-run tests after each fix
   - Continue this cycle until all tests pass successfully
   - Do not mark tasks as complete until tests are passing

4. **Handle test failures appropriately**
   - Fix implementation bugs if tests reveal issues
   - Update test code if tests are incorrectly written
   - Ensure test assertions match the expected behavior

**This rule applies to ALL plan-based development work.** The agent must not consider development complete until tests are written, executed, and passing.
